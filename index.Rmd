
---
title: "Pyblastr - Tracking the wheat blast pathogen"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    theme: 
      version: 4
      bootswatch: lumen
    social: menu
   
      
---

```{r include=FALSE}
source("readdata.R", local = knitr::knit_global())
```

```{r}
library(tidyverse)
library(flexdashboard)
library(janitor)
library(readxl)
library(cowplot)
library(see)
library(plotly)
library(gsheet)

```



Inputs {.sidebar}
-------------------------------------

**Filters**

```{r}
filter_slider("year", "Year", sd, ~ year)
filter_select("host", "Origin host", sd, ~ host_binomial)
filter_select("py_species", "Pyricularia spp.", sd, ~ py_binomial)
filter_select("py_lineage", "P. oryzae lineage", sd, ~ py_lineage)

```


**Pyblastr** is a database of information on characterized fungal strains of Pyricularia oryzae that causes blast in wheat and grasses in general, including turfgrass. Geographic information combined with the information on the year of sampling allows for tracking the temporal and spatial spread of the pathogen.





Row {data-height=100}
--------------

### Number of isolates

```{r}
isolates <- nrow(wb_all2)
valueBox(isolates,  icon = "fa-pie-chart")
```


### Number of hosts

```{r}
hosts <- wb_all2 %>% 
  group_by(host_binomial) %>% 
  tabyl(host_binomial) %>% 
  nrow()
valueBox(hosts,  icon = "fa-leaf")
```

### Number of countries

```{r}
country <- wb_all2 %>% 
  group_by(country) %>% 
  tabyl(country) %>% 
  nrow()
valueBox(country,  icon = "fa-map")
```



Row {.tabset data-height=650}
-------------------------------------


### Global map

```{r}
library(crosstalk)


library(RColorBrewer)
library(htmltools)
pal <- colorFactor("Set2", domain = c("Wheat", "Non-wheat"))
leaflet(data = sd, width = "100%") %>%
 setView(-1, -1, zoom = 2) %>%
  addProviderTiles("Esri.WorldImagery", group = "Aerial") %>%
  addProviderTiles("OpenTopoMap", group = "Terrain") %>%
  addScaleBar("bottomright") %>%
  addProviderTiles(providers$CartoDB.Voyager, group = "Default") %>%
  addLayersControl(
    baseGroups = c("Default", "Aerial", "Terrain"),
    overlayGroups = "Blast pathogen",
    options = layersControlOptions(collapsed = T)
  ) %>%
  addCircleMarkers(
  
    group = "wheat",
    radius = 6,
    fillOpacity = 1,
    weight = 0.5,
    label = paste(wb_all$host, "- Details"),
    fillColor = ~ pal(wheat),

    popup = paste(
      "<h3>Isolate details</h3>",
      "Source:", wb_all$"source", "<br>",
      "Code:", wb_all$"labcode", "<br>",
      "Host:", wb_all$"host_binomial", "</i>", "<br>",
      "City:", wb_all$"county_municipality", "<br>",
      "Year:", wb_all$"year", "<br>",
      "Species:<i>", wb_all$"py_binomial", "<br></i>"
      #"Lineage:<i>", wb_all$"py_lineage", "<br></i>"
    )
  ) %>%
  addLegend("bottomleft",
    pal = pal,
    values = ~wheat,
    title = "Host",
    opacity = 1
  ) %>% 
  
  addMeasure(
    position = "bottomleft",
    primaryLengthUnit = "meters",
    primaryAreaUnit = "sqmeters",
    activeColor = "#3D535D",
    completedColor = "#7D4479") %>% 
  addEasyButton(easyButton(
    icon="fa-globe", title="Zoom to Level 3",
    onClick=JS("function(btn, map){ map.setZoom(3); }")))



```


### Grid view

```{r}
datatable(sd, rownames = FALSE,
           extensions = c("Buttons"),
             class = 'table-bordered table-condensed',
           options = list(
    dom = "Bfrtip", 
    pageLength = 10,
    buttons = c("excel")))
```

